
Here’s a complete, professionally written README.md file in your preferred paragraph-style format, consistent with the earlier templates you used for other CVS Health Snowflake SQL workflows:

⸻

Deleted Scripts Analysis – Central Fill (CF) with NDC and Pricing

This SQL script identifies and analyzes deleted Central Fill (CF) prescriptions that were shipped but never checked in at the home store, including detailed information such as NDC, selling price, delivery tracking, and key workflow timestamps. It integrates multiple curated data sources from Snowflake to track prescription lifecycle activities, delivery events, and associated product information for root-cause and performance analysis.

⸻

Overview

The purpose of this workflow is to detect prescriptions that were deleted after being shipped from Central Fill but not successfully received or checked in by the home store. By combining activity logs, order tracking, and prescription fill data, the query helps identify potential inventory mismatches, workflow delays, or data integrity gaps in the CF-to-store delivery process.

The script extracts and consolidates data from multiple sources, including:
	•	CORE_RX.CURATED_SCRIPT.PRESCRIPTION_FILL_ACTIVITY and PRESCRIPTION_FILL_XREF for fill activities.
	•	CORE_FSSC.CURATED_ORDERS.ORDER_DELIVERY and ORDER_DELIVERY_HISTORY for courier and tracking data.
	•	CORE_RX.CURATED_SCRIPT.PRESCRIPTION_FILL, RXC_PRESCRIPTION_FILL_RT, and WAITING_BIN_SLOT_CONTENTS for fill details, latest statuses, and waiting bin assignments.
	•	CORE_RX.CURATED_LOCATION.STORE for geographic hierarchy attributes (division, region, and district).

⸻

Workflow Logic

1. CF_ACT (Central Fill Activity Tracking)

This section collects all key activity timestamps for each prescription (RX_NBR, FILL_NBR, HOME_STORE_NBR):
	•	Activity 4 – Verification Completed
	•	Activity 202 – Check-In
	•	Activity 203 – Shipped from Central Fill
	•	Activity 23 / 16 – Deleted
	•	Activity 201 – CF Delete
	•	Activity 8 – Returned to Stock
	•	Activity 14 – Transfer Out

Records are filtered for transactions occurring after December 1, 2024, and grouped by prescription identifiers. Only scripts that have shipped, delivered, or checked in events are included to ensure completeness.

⸻

2. CF_PNP (Pick-and-Pack Delivery Tracking)

This section gathers delivery journey data for each shipped prescription using the CF-STS (Central Fill to Store) delivery SLA. It links orders from ORDER_DELIVERY and ORDER_DELIVERY_HISTORY to capture critical timestamps such as:
	•	Order Created (Status 10)
	•	Prepared (Status 2)
	•	Handoff to Courier (Status 13)
	•	Delivered (Status 4)
	•	Cancelled (Status 8)
	•	Attempted Delivery (Status 14)
	•	Handoff Failure (Status 20)

Each record is enriched with courier name, tracking number, and store hierarchy details (division, region, and district) for operational mapping.

⸻

3. CF_PF (Prescription Fill and Pricing Details)

This section retrieves pricing and fill-level details for scripts deleted after shipment but not yet checked in:
	•	Joins the CF activity data (CF_ACT) with prescription fill tables (PRESCRIPTION_FILL and RXC_PRESCRIPTION_FILL_RT) to extract NDC, fill status, state codes, and selling price.
	•	Includes waiting bin data from WAITING_BIN_SLOT_CONTENTS to identify if the prescription was still in a bin at the home store.
	•	Ensures the deletion date occurred after shipment, with no transfer-out or RTS events recorded post-shipment.

The output includes:
	•	Act_delete_date, CF_delete_date, CF_verify_date, shipped_date
	•	SELLING_PRICE_AMT, DISPENSE_QTY, NDC, and WAIT_BIN_LOCATION_CD

⸻

4. CF_NCHECKIN_JOINED (Final Consolidated Dataset)

This final section merges prescription, delivery, and pricing data to form a unified view of deleted scripts that were shipped but not checked in.
It introduces the following computed fields:
	•	SOLD_DT: Captures the most recent sale timestamp based on fill status (7 = Sold).
	•	DELIVERED_DATE and CANCELLED_DATE from delivery tracking.
	•	CF hierarchy attributes (division, region, district).

The result set filters records where:
	•	TRACKING_NBR is not null (valid delivery record),
	•	ACT_DELETE_DATE is not null (confirmed deletion),
	•	NDC is available, and
	•	ORDER_DATE is within the last 25 days.

⸻

Output and Insights

The final query produces a granular dataset that enables teams to:
	•	Identify deleted Central Fill prescriptions that were shipped but never checked in.
	•	Review NDC and price information for reconciliation and financial impact analysis.
	•	Trace courier-level delivery patterns, including delayed or failed deliveries.
	•	Evaluate workflow performance by region, district, and CF facility.

This output serves as the foundational dataset for audit dashboards and operational investigations, ensuring transparency across the CF delivery and deletion workflow.

⸻

Summary

The Deleted Scripts Analysis query integrates multiple Snowflake-curated datasets to provide a unified view of deleted, shipped prescriptions that were not checked in at home stores. It combines activity history, logistics tracking, and financial attributes (NDC, price) to improve oversight of prescription movement and identify discrepancies in the Central Fill lifecycle.

⸻
