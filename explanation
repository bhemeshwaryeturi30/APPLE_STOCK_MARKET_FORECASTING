
Perfect ‚Äî here‚Äôs your fully structured, GitHub-ready README.md written in the same professional template and tone you‚Äôve been using for your Snowflake/Teradata repositories.
It summarizes all three SQL scripts: ExceptionOutreaches.sql, Exception_Outreach_Procedure.sql, and Exception_Outreach_Scheduler.sql.

‚∏ª

SQL Queries and Procedure for Exception Outreach Dashboard Data Creation

This repository contains SQL scripts and procedures used for generating and scheduling data pipelines for the Exception Outreach Dashboard.
These scripts are designed for execution in Snowflake and leverage curated datasets from the CORE_RX and CORE_FSSC schemas.
The dashboard provides comprehensive insights into exception outreach volumes, action note performance, and resolution trends across fiscal periods.

‚∏ª

Overview

The Exception Outreach Dashboard automates the tracking and analysis of exception outreach performance across retail and pharmacy operations.
It calculates metrics related to:
	‚Ä¢	Action note creation and resolution rates
	‚Ä¢	Inducted prescription volume and engagement ratios
	‚Ä¢	OnR (Order Not Ready) and STR (Scripts Through QV2 ‚Üí Sold) performance
	‚Ä¢	Average days to resolve exceptions
	‚Ä¢	Chain-level metrics (ONR_CHAIN and STR_CHAIN) for benchmarking

All logic is implemented within a parameterized stored procedure (Exception_Outreaches_Procedure) that dynamically refreshes and recreates the base and summary tables within Snowflake.

‚∏ª

Setup and Environment

Before running the procedure, ensure the following are correctly set:

USE DATABASE DL_RX_OPERATION;
USE SCHEMA RX_OPS_SANDBOX;
USE WAREHOUSE WH_RX_QUERY_RXANALYTICS_01;

Source Databases:
	‚Ä¢	CORE_RX.CURATED_SCRIPT
	‚Ä¢	CORE_FSSC.CURATED_CALENDAR
	‚Ä¢	APP_OMNIRX.OMNI_DL
	‚Ä¢	APP_OMNIRX.OMNI_KPI

Destination Tables (Outputs):
	‚Ä¢	DL_RX_OPERATION.RX_OPS_SANDBOX.EXCEPTION_OUTREACH_DASHBOARD
	‚Ä¢	DL_RX_OPERATION.RX_OPS_SANDBOX.EXCEPTION_OUTREACH_DASHBOARD_ACTION_NOTE_LEVEL
	‚Ä¢	DL_RX_OPERATION.RX_OPS_SANDBOX.EXCEPTION_OUTREACH_DASHBOARD_ACTION_NOTE_LEVEL_FISCAL_WEEK

‚∏ª

Core Components and Scripts

1. ExceptionOutreaches.sql

Purpose:
Provides direct access to the final dashboard table for validation or downstream consumption.

SELECT * 
FROM DL_RX_OPERATION.RX_OPS_SANDBOX.EXCEPTION_OUTREACH_DASHBOARD;

Output Fields:

Column	Description
FISCAL_MONTH_NBR	Fiscal month number
TOTAL_ACTION_NOTES	Total action notes logged
TOTAL_RX_WITH_ACTION_NOTE	Total prescriptions tied to at least one action note
TTL_INDUCTED	Total inducted prescriptions
ONR_RATE	Order Not Ready rate
STR	Scripts Through QV2 to Sold ratio
AVERAGE_DAYS_TO_RESOLVE	Average time to resolve exception notes
ONR_CHAIN, STR_CHAIN	Chain-level performance benchmarks


‚∏ª

2. Exception_Outreach_Procedure.sql

Purpose:
Defines the stored procedure that constructs the Exception Outreach Dashboard and supporting summary tables.
This procedure automates all data transformations, aggregations, and joins across curated Snowflake layers.

Key Functional Sections:

üß© Step 1: Fiscal Context Initialization
	‚Ä¢	Derives FISCAL_WEEK_START, FISCAL_WEEK_END, START_DATE, and END_DATE
	‚Ä¢	Filters data to recent six months of activity

üß± Step 2: Base Table Creation
	‚Ä¢	BASE_RX: Captures prescription fills and metadata
	‚Ä¢	INDUCTED_RX: Tracks inducted prescriptions via PRESCRIPTION_FILL_ACTIVITY

üìä Step 3: Aggregation Layers
	‚Ä¢	ACTION_NOTE_VOLUME: Calculates total action notes and associated prescriptions
	‚Ä¢	INDUCTED_SCRIPTS: Counts inducted prescriptions per fiscal month
	‚Ä¢	EXCEPTION_OUTREACH_VOLUME: Combines metrics to compute action note ratios

üîÑ Step 4: ONR & STR Metrics
	‚Ä¢	Joins with APP_OMNIRX.OMNI_DL.ONR_FINAL_TBL to calculate:
	‚Ä¢	ONR_NUM, ONR_DEN, and ONR_RATE (Order Not Ready metrics)
	‚Ä¢	STR (Script Sold Rate post-QV2)
	‚Ä¢	Derives average days to resolve exception notes

üèÅ Step 5: Dashboard Materialization

Creates multiple levels of output granularity:

Table	Level	Description
EXCEPTION_OUTREACH_DASHBOARD	Fiscal Month	Consolidated ONR/STR metrics and averages
EXCEPTION_OUTREACH_DASHBOARD_ACTION_NOTE_LEVEL	Fiscal Month by Action Note Type	Breakdown by trigger and type
EXCEPTION_OUTREACH_DASHBOARD_ACTION_NOTE_LEVEL_FISCAL_WEEK	Fiscal Week by Action Note Type	Granular weekly trends

üîó Step 6: Chain Benchmark Integration
	‚Ä¢	CHAIN_ONR and SOLD_RATE temporary tables fetch chain-wide metrics
	‚Ä¢	Adds ONR_CHAIN and STR_CHAIN ratios to the final dashboard

‚è± Step 7: Inducted RX Volume (Weekly)
	‚Ä¢	INDUCTED_RX_BY_FISCAL_WEEK summarizes weekly induction counts
	‚Ä¢	Joins into the weekly action note-level dashboard

Return Value:

RETURN 'Task completed successfully';

Procedure Execution Example:

CALL Exception_Outreaches_Procedure();


‚∏ª

3. Exception_Outreach_Scheduler.sql

Purpose:
Automates the weekly execution of the Exception Outreach Procedure using a Snowflake Task Scheduler.

Task Definition:

CREATE OR REPLACE TASK Exception_outreach_schedule
  WAREHOUSE = WH_RX_QUERY_RXANALYTICS_01
  SCHEDULE = 'USING CRON 15 2 * * 3 America/New_York'
AS
  CALL Exception_Outreaches_Procedure();

Explanation:
	‚Ä¢	Executes every Wednesday at 2:15 AM EST (07:15 UTC)
	‚Ä¢	Refreshes the dashboard tables with the latest exception outreach and action note metrics
	‚Ä¢	Can be resumed or paused as needed using:

ALTER TASK Exception_outreach_schedule RESUME;
ALTER TASK Exception_outreach_schedule SUSPEND;



‚∏ª

Analytical Focus

Metric Category	Description	Derived From
Exception Volume	Total action notes and scripts requiring outreach	ACTION_NOTE_VOLUME, EXCEPTION_OUTREACH_VOLUME
Resolution Efficiency	Avg. days to resolve by fiscal month/week	ACTION_NOTES_STEP2
ONR Performance	Share of scripts marked ‚ÄúOrder Not Ready‚Äù	STR_ONR_EXCEPTION_OUTREACHES
STR Conversion	Rate of QV2 scripts sold within 14 days	SCRIPTS_SOLD, SCRIPTS_THROUGH_QV2
Trigger Distribution	Counts by trigger type (SUPPRESS, SYSTEMATIC, OPTION-T, etc.)	ACTION_NOTES_STEP2
Chain Benchmarks	Network-wide ONR and STR comparison metrics	CHAIN_ONR, SOLD_RATE


‚∏ª

Appendix

All files consolidated:

File	Description
ExceptionOutreaches.sql	Retrieves the final dashboard output
Exception_Outreach_Procedure.sql	Defines data pipeline and aggregation logic
Exception_Outreach_Scheduler.sql	Automates weekly refresh of dashboard metrics


‚∏ª

Recommended GitHub Enhancements (Optional)

You can add:
	‚Ä¢	A data flow diagram (Procedure ‚Üí Dashboard Tables ‚Üí Visualization Layer)
	‚Ä¢	Dashboard snapshots (Power BI / Tableau tiles) showing ONR, STR, and average resolution trends
	‚Ä¢	A ‚ÄúLast Refreshed On‚Äù section in README linked to the Snowflake Task log

‚∏ª

Would you like me to add a visual ‚ÄúData Flow Overview‚Äù diagram in ASCII format (like the earlier one) showing how data flows from curated sources ‚Üí procedure ‚Üí dashboard tables ‚Üí scheduler ‚Üí visualization? It would make this README visually complete and GitHub-ready.
