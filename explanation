

This repository contains SQL queries used to build the Central Fill Operations and Performance Dashboard, designed to analyze key operational metrics across Teradata and Snowflake data sources.
The dashboard measures production efficiency, shipping accuracy, SLA adherence, carryover trends, and cost metrics to provide actionable insights for Central Fill (CF) network performance optimization.

⸻

Overview

The queries in this repository focus on aggregating and transforming operational data to support key performance indicators (KPIs) related to Central Fill pharmacy operations.
The dashboard highlights metrics such as:
	•	Script Production and Shipping Volumes
	•	SLA (Ship by / Customer Promised Date) Adherence
	•	Carryover Rate Analysis
	•	Shipping Cost per Package
	•	Same-Day Check-In and Fill Completion Rates
	•	Prescription Transfer and Delivery Performance

Data is extracted and joined across Teradata and Snowflake environments, integrating both prescription workflow and logistics delivery systems to enable end-to-end visibility of CF operations.

⸻

Setup and Variables

Before executing the queries, connect to the correct database source and environment:

-- For Snowflake
USE DATABASE CORE_RX;
USE SCHEMA CURATED_SCRIPT;

-- For Teradata
DATABASE RXCOE_SA;
DATABASE IDW_COMMON;

Recommended date filters:

-- Example for filtering fiscal data
WHERE FISCAL_YEAR_START_DT >= DATE'2024-01-01'
AND FISCAL_WEEK_END_DT < CURRENT_DATE;

All queries follow standardized fiscal dimensions using CORE_FSSC.CURATED_CALENDAR joins for consistent fiscal year, month, and week alignment.

⸻

Core Tables and Queries

1. carryover.sql

Source: Snowflake (CORE_FSSC, CORE_RX)
Purpose:
Analyzes carryover fill volume — prescriptions not handed off within the same day — to measure CF throughput and delay patterns.

Logic Highlights:
	•	Joins order, fill, and delivery tables (order_delivery, order_delivery_history, PRESCRIPTION_FILL_XREF)
	•	Localizes timestamps by regional time zones (Central, Mountain, Pacific)
	•	Aggregates fill counts where Handoff_Date > HOLDING_QUEUE_OUT
	•	Groups by fiscal dimensions (Year, Month, Week) and CF Store

Key Metrics:

Metric	Description
fill_count	Count of prescriptions handed off after the holding queue cutoff
total_fill_count	Total fills processed in the period
FISCAL_YEAR_NBR, FISCAL_MONTH_NBR, CF_STORE_NBR	Core grouping dimensions

Supplementary Data:
An Excel input file (comments&targets.xlsx) provides contextual store-level targets and comments with columns:
Store Number, Metric, Target, Comments, Update Date, FISCAL_YEAR_NBR, FISCAL_MONTH_NBR, CF_STORE_NBR, etc.

⸻

2. operationmetrics.sql

Source: Teradata (RXCOE_SA.SG_CF_MASTER, IDW_COMMON.SEM_DIM_ALL_FISCAL_CAL_WEEK)
Purpose:
Calculates key operational metrics including fill production, shipping completion, and SLA adherence.

Key Metrics:

Metric	Description
FILLS_PRODUCED	Total prescriptions produced in CF facilities
FILLS_SHIPPED	Scripts successfully shipped to stores
FILLS_CHECKEDIN	Scripts checked in at destination store
CUST_SLA_NUM / CUST_SLA_DEN	SLA adherence numerator/denominator
SAME_DAY_CHECKIN_NUM / DEN	Same-day check-in rate

Purpose:
Enables weekly monitoring of production and shipping efficiency per CF Store and State.

⸻

3. operationmetrics2.sql

Source: Teradata
Purpose:
Variant of operationmetrics.sql extending data scope and accommodating partially null or historical records.

Enhancements:
	•	Broader inclusion of prescription lifecycle events (CHECKIN, SHIPPED, CHG_EXP_DATE_DT)
	•	Anchored on fiscal year start from 2023
	•	Useful for year-over-year operational trend comparison

Key Output Dimensions:
FISCAL_YEAR_NBR, FISCAL_MONTH_NBR, FISCAL_WEEK_END_DT, CF_STORE_NBR, ST_CD

⸻

4. spp.sql (Shipping Package Performance)

Source: Snowflake (CORE_FSSC.CURATED_ORDERS)
Purpose:
Tracks shipping performance (SPP) by analyzing tracking numbers and handoff timing to measure fulfillment rates.

Logic Highlights:
	•	Joins order and delivery tables (ORDER_DELIVERY, ORDER_DELIVERY_ITEM)
	•	Aggregates shipment counts by fiscal week and month
	•	Anchors metrics on handoff date vs. create date for SLA comparison

Key Metrics:

Metric	Description
TRACK_CNT	Number of unique shipments (tracking numbers)
RX_CNT	Unique prescription count per CF store
CF_STORE_NBR, HOME_STORE	CF and destination identifiers

Used For:
Evaluating shipping accuracy, consistency, and order fulfillment volume.

⸻

5. shipbySLA.sql

Source: Snowflake (CORE_RX.CURATED_SCRIPT.CENTRAL_FILL_RX_ASSIGNMENT)
Purpose:
Calculates SLA performance based on ship-by dates, identifying shipments meeting or missing SLA windows.

Logic Highlights:
	•	Flags late creations (CRTE_AFTER_SLA_FLAG)
	•	Compares CENTRAL_FILL_SHIPPING_TS with SHIP_BY_TS and HOLDING_QUEUE_OUT_TS
	•	Aggregates SLA met vs. total shipped counts

Key Metrics:

Metric	Description
SLA_MET_CNT	Count of shipments meeting SLA conditions
TOT_RX_CNT	Total shipped prescriptions
CRTE_AFTER_SLA_FLAG	Late creation indicator


⸻

6. TotalScriptVolumeFromPnP.sql

Source: Snowflake (CORE_FSSC.CURATED_ORDERS)
Purpose:
Calculates total Pick and Pack (PnP) prescription volumes across CF stores, capturing the entire prescription lifecycle from order creation to handoff.

Logic Highlights:
	•	Combines order_delivery, order_delivery_item, and order_delivery_history
	•	Includes various order status codes (prep, shipped, delivered, cancelled, etc.)
	•	Links with fiscal calendar for consistent temporal reporting

Key Output Fields:

Field	Description
CF_STORE_NBR	Central Fill facility number
TRACKING_NBR	Shipment tracking number
FISCAL_WEEK_NBR, FISCAL_MONTH_NBR, FISCAL_YEAR_NBR	Time-based aggregations
HOME_STORE_NBR	Destination store number
RX_NBR, FILL_NBR	Prescription identifiers


⸻

7. Shipping Cost per Package (Excel Source)

Source: Excel file
Columns:

Column	Description
FISCAL_YEAR_NBR	Fiscal year number
FISCAL_MONTH_NBR	Fiscal month number
STORE_NBR	Central Fill store number
Cost Per Package	Average cost per shipment
SPP	Shipping performance parameter


