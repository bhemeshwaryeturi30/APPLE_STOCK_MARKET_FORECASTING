
Here‚Äôs a professional and concise README.md file you can include in your GitHub repository for the above Time Spent Analysis SQL project:

‚∏ª

‚è±Ô∏è Time Spent Analysis ‚Äì DWSAB Utilization Framework

This repository contains the SQL framework used to calculate colleague time allocation across various pharmacy work queues (QT, QV, QP, and POS) ‚Äî determining time spent inside versus outside assigned card responsibilities at the store level.
The logic is based on CVS Health‚Äôs DWSAB (Daily Workload Scheduling Assignment Board) system.

‚∏ª

üß≠ Objective

To measure employee utilization within a pharmacy store by determining:
	‚Ä¢	A) Time spent working within assigned DWSAB cards (aligned with scheduled tasks).
	‚Ä¢	B) Time spent working outside of assigned cards (unplanned or ad-hoc tasks).

This helps evaluate staffing effectiveness, workflow adherence, and performance optimization.

‚∏ª

‚öôÔ∏è Query Structure Overview

1Ô∏è‚É£ DWSAB Data Preparation
	‚Ä¢	Extracts and cleans raw DWSAB data (APP_DEWA.DEWA_RPT.NOTIFICATIONS).
	‚Ä¢	Removes overlapping or duplicate cards.
	‚Ä¢	Reassigns card start and end times to handle :00 and :05 edge conditions.
	‚Ä¢	Aggregates activities per colleague, ensuring one record per person per card.
	‚Ä¢	Merges with DWSAB_CARD_MASTER to identify expected queue activities (QT, QV, QP, POS).

‚∏ª

2Ô∏è‚É£ Queue Data Integration

a) QT ‚Äì Triage Queue
	‚Ä¢	Pulls records from CORE_RX.CURATED_SCRIPT.TRIAGE_QUEUE.
	‚Ä¢	Joins with prescription and activity tables to match actual events.
	‚Ä¢	Assigns job roles (RPH, TECH, MISC) using EMPLOYEE master.
	‚Ä¢	Converts timestamps to store-local timezones for consistency.

b) QV ‚Äì Verification Queue
	‚Ä¢	Uses RXC_VERIFICATION_QUEUE data to calculate verification time.
	‚Ä¢	Adjusts verification start/end times and applies role mapping logic.
	‚Ä¢	Capped at 300 seconds per verification task to limit outliers.

c) QP ‚Äì Production Queue
	‚Ä¢	Derived from PRESCRIPTION_FILL_ACTIVITY (activities: label print, scan, etc.).
	‚Ä¢	Estimates task time based on activity codes and standard timings.
	‚Ä¢	Joins with employee details and applies timezone conversion.

d) POS ‚Äì Drive Thru and Non-Drive Thru
	‚Ä¢	Extracts from POS_EVENT_HEADER + POS_EVENT_DETAIL.
	‚Ä¢	Filters for patient search interactions at POS terminals.
	‚Ä¢	Calculates transaction duration per employee and assigns job roles.

‚∏ª

3Ô∏è‚É£ Work Item Consolidation

All work queues are unioned into one dataset (WORK_ITEMS) containing:
	‚Ä¢	WORK_TYPE (QT, QV, QP, POS, POS DRIVE THRU)
	‚Ä¢	STORE_NBR, EMPLOYEE_ID, WORK_ITEM_START_TS, and ELAPSED_SECS

Each record represents a discrete time slice of work performed.

‚∏ª

4Ô∏è‚É£ DWSAB Integration and Utilization Calculation
	‚Ä¢	Joins work items with DWSAB cards to determine if activities fall within or outside assigned card times.
	‚Ä¢	Creates summary tables (DWSAB_UTILIZATION) that calculate:
	‚Ä¢	Time spent per queue within/outside assignment.
	‚Ä¢	Percentage distribution of total time.

‚∏ª

üìä Key Output Metrics

Metric	Description
QT_WITHIN_CARD_PCT	% of triage queue time within card assignment
QV_WITHIN_CARD_PCT	% of verification queue time within card
QP_WITHIN_CARD_PCT	% of production activity within card
POS_WITHIN_CARD_PCT	% of POS activity within card
TOT_WITHIN_CARD_PCT	Overall % of time within scheduled card activities


‚∏ª

üß† Data Sources

Dataset	Description
APP_DEWA.DEWA_RPT.NOTIFICATIONS	Raw DWSAB card and scheduling data
CORE_RX.CURATED_SCRIPT.*	Core pharmacy scripts, activities, and queues
DL_RX_OPERATION.RX_OPS_SANDBOX.*	Sandbox reference tables for card mapping, labor standards, and employees
CORE_RX.CURATED_LOCATION.STORE	Store timezone and metadata mapping


‚∏ª

üß© Logic Highlights
	‚Ä¢	Uses window functions (DENSE_RANK, LEAD, ROW_NUMBER) for card sequencing and deduplication.
	‚Ä¢	Applies time zone adjustments based on store geography.
	‚Ä¢	Caps extreme durations (LEAST and COALESCE for robust bounds).
	‚Ä¢	Employs case-based logic to map PBM/queue activities to roles and expectations.

‚∏ª

üßÆ Outputs

Table	Purpose
DWSAB_DATA	Cleaned DWSAB card records with expected queue flags
QT_DATA, QV_DATA, QP_DATA, POS_DATA	Processed queue-specific time records
WORK_ITEMS	Unified view of all work events
DWSAB_UTILIZATION	Final store- and employee-level summary of inside vs. outside card time


‚∏ª

üöÄ How to Run
	1.	Set the fiscal week to analyze:

WHERE CAL.FISCAL_WEEK_NBR = 202406;


	2.	Execute the script sequentially (top to bottom) in Snowflake or your analytics warehouse.
	3.	Review final output tables or run the summary query:

SELECT * FROM DWSAB_UTILIZATION;


	4.	Optionally, aggregate results by store or employee for reporting.

‚∏ª

üßæ Author & Attribution

Author: Shane Gorth ‚Äì CVS Health Analytics
Updated by: Data Engineering & Operations Analytics Team
Contact: shane.gorth@cvshealth.com

‚∏ª

Would you like me to create a shorter ‚Äúexecutive summary‚Äù README (2‚Äì3 paragraphs) or a technical README with table schema diagrams for this script version?
