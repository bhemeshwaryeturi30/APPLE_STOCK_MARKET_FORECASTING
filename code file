sql code 1:


--Teradata Source

SELECT 
--Dimensions Calendar
t1.FISCAL_WEEK_NBR,
t1.FISCAL_YEAR_NBR,
t1.FISCAL_MONTH_NBR,
t0.PROD_FISCAL_WEEK_NBR,
t1.FISCAL_MONTH_END_DT, 
t1.FISCAL_WEEK_start_DT,
t1.FISCAL_WEEK_END_DT, 
--Dimensions Location
t0.CF_STORE_NBR,
t0.ST_CD,

COUNT(DISTINCT t0.PRSCRT_FILL_ID) as FILLS_PRODUCED,
--Sum(CASE WHEN t0.PRSCRT_FILL_ID IS NOT NULL THEN 1.000000 END) FILLS_PRODUCED_v2,
COUNT(DISTINCT CASE WHEN t0.LAST_PV2_DT IS NOT NULL THEN t0.PRSCRT_FILL_ID ELSE NULL END) as FILLS_PV2,
COUNT(DISTINCT CASE WHEN t0.LAST_CF_SHIPPED_DT IS NOT NULL THEN t0.PRSCRT_FILL_ID ELSE NULL END) as FILLS_SHIPPED,
COUNT(DISTINCT CASE WHEN t0.LAST_CF_CHECKIN_DT IS NOT NULL THEN t0.PRSCRT_FILL_ID ELSE NULL END) as FILLS_CHECKEDIN,
COUNT(DISTINCT CASE WHEN t0.POS_TRNCT_DT  IS NOT NULL THEN t0.PRSCRT_FILL_ID ELSE NULL END) as FILLS_SOLD_ACT,
COUNT(DISTINCT CASE WHEN t0.SALE_END_IND=1  AND t0.POS_TRNCT_DT  IS NOT NULL THEN t0.PRSCRT_FILL_ID ELSE NULL END) as FILLS_SOLD,
--SLA by Promised
--SUM(CASE WHEN t0.DELIVERED_DATE < t0.NEW_PRM_DT THEN 1 ELSE 0 END) as SLA_NUM,
SUM(CASE WHEN CAST(t0.DELIVERED_DATE as DATE) <= CAST(t0.NEW_PRM_DT as DATE) THEN 1 ELSE 0 END) as CUST_SLA_NUM,
SUM(CASE WHEN t0.DELIVERED_DATE IS NOT NULL AND  t0.NEW_PRM_DT IS NOT NULL THEN 1 ELSE 0 END) as CUST_SLA_DEN,
SUM(CASE WHEN t0.HANDOFF_DATE IS NOT NULL AND  t0.NEW_PRM_DT < CURRENT_DATE THEN 1 ELSE 0 END) as CUST_SLA_DEN_V2,
--Same Day Checkin
SUM(CASE WHEN t0.DELIVERED_DATE IS NOT NULL AND CAST(t0.DELIVERED_DATE as DATE) = CAST(t0.LAST_CF_CHECKIN_DT as DATE) THEN 1 ELSE 0 END) as SAME_DAY_CHECKIN_NUM,
SUM(CASE WHEN t0.DELIVERED_DATE IS NOT NULL AND t0.LAST_CF_CHECKIN_DT IS NOT NULL THEN 1 ELSE 0 END) as SAME_DAY_CHECKIN_DEN,
SUM(CASE WHEN t0.DELIVERED_DATE IS NOT NULL THEN 1 ELSE 0 END) as SAME_DAY_CHECKIN_DEN_V2
--Order Ready
FROM RXCOE_SA.SG_CF_MASTER t0
LEFT JOIN IDW_COMMON.SEM_DIM_ALL_FISCAL_CAL_WEEK t1 ON t0.PROD_FISCAL_WEEK_NBR = t1.FISCAL_WEEK_NBR 
WHERE 
(CENTR_FILL_STUS_IND='Y' OR 
LAST_CF_SHIPPED_DT IS NOT NULL and 
LAST_CF_SHIPPED_DT between t1.FISCAL_WEEK_start_DT and t1.FISCAL_WEEK_END_DT
OR
--LAST_CF_REJECT_DT IS NOT NULL OR
LAST_CF_CHG_EXP_DATE_DT IS NOT NULL OR
LAST_CF_ENT_QI_DT IS NOT NULL)
AND FISCAL_YEAR_START_DT >= DATE'2024-01-01'
and LAST_CF_SHIPPED_DT between t1.fiscal_week_start_dt and t1.fiscal_week_end_dt
AND FISCAL_YEAR_START_DT < CURRENT_DATE
and FISCAL_week_end_DT < CURRENT_DATE
and t0.CF_STORE_NBR is not null
GROUP BY 1,2,3,4,5,6,7,8,9


sql code 2:
--Teradata Source

SELECT 
--Dimensions Calendar
t1.FISCAL_YEAR_NBR,
t1.FISCAL_MONTH_NBR,
t0.PROD_FISCAL_WEEK_NBR,
t1.FISCAL_MONTH_END_DT,
t1.FISCAL_WEEK_END_DT, 
--Dimensions Location
t0.CF_STORE_NBR,
t0.ST_CD,
--t0.STORE_NBR,
--Metrics
COUNT(DISTINCT t0.PRSCRT_FILL_ID) as FILLS_PRODUCED,
--Sum(CASE WHEN t0.PRSCRT_FILL_ID IS NOT NULL THEN 1.000000 END) FILLS_PRODUCED_v2,
COUNT(DISTINCT CASE WHEN t0.LAST_PV2_DT IS NOT NULL THEN t0.PRSCRT_FILL_ID ELSE NULL END) as FILLS_PV2,
COUNT(DISTINCT CASE WHEN t0.LAST_CF_SHIPPED_DT IS NOT NULL THEN t0.PRSCRT_FILL_ID ELSE NULL END) as FILLS_SHIPPED,
COUNT(DISTINCT CASE WHEN t0.LAST_CF_CHECKIN_DT IS NOT NULL THEN t0.PRSCRT_FILL_ID ELSE NULL END) as FILLS_CHECKEDIN,
COUNT(DISTINCT CASE WHEN t0.POS_TRNCT_DT  IS NOT NULL THEN t0.PRSCRT_FILL_ID ELSE NULL END) as FILLS_SOLD_ACT,
COUNT(DISTINCT CASE WHEN t0.SALE_END_IND=1  AND t0.POS_TRNCT_DT  IS NOT NULL THEN t0.PRSCRT_FILL_ID ELSE NULL END) as FILLS_SOLD,
--SLA by Promised
--SUM(CASE WHEN t0.DELIVERED_DATE < t0.NEW_PRM_DT THEN 1 ELSE 0 END) as SLA_NUM,
SUM(CASE WHEN CAST(t0.DELIVERED_DATE as DATE) <= CAST(t0.NEW_PRM_DT as DATE) THEN 1 ELSE 0 END) as CUST_SLA_NUM,
SUM(CASE WHEN t0.DELIVERED_DATE IS NOT NULL AND  t0.NEW_PRM_DT IS NOT NULL THEN 1 ELSE 0 END) as CUST_SLA_DEN,
SUM(CASE WHEN t0.HANDOFF_DATE IS NOT NULL AND  t0.NEW_PRM_DT < CURRENT_DATE THEN 1 ELSE 0 END) as CUST_SLA_DEN_V2,
--Same Day Checkin
SUM(CASE WHEN t0.DELIVERED_DATE IS NOT NULL AND CAST(t0.DELIVERED_DATE as DATE) = CAST(t0.LAST_CF_CHECKIN_DT as DATE) THEN 1 ELSE 0 END) as SAME_DAY_CHECKIN_NUM,
SUM(CASE WHEN t0.DELIVERED_DATE IS NOT NULL AND t0.LAST_CF_CHECKIN_DT IS NOT NULL THEN 1 ELSE 0 END) as SAME_DAY_CHECKIN_DEN,
SUM(CASE WHEN t0.DELIVERED_DATE IS NOT NULL THEN 1 ELSE 0 END) as SAME_DAY_CHECKIN_DEN_V2
--Order Ready
FROM RXCOE_SA.SG_CF_MASTER t0
LEFT JOIN IDW_COMMON.SEM_DIM_ALL_FISCAL_CAL_WEEK t1 ON t0.PROD_FISCAL_WEEK_NBR = t1.FISCAL_WEEK_NBR 
WHERE 
(CENTR_FILL_STUS_IND='Y' OR 
t0.PRSCRT_FILL_ID IS NULL OR --Why am I taking this?
LAST_CF_CHECKIN_DT IS NOT NULL OR
LAST_CF_SHIPPED_DT IS NOT NULL OR
--LAST_CF_REJECT_DT IS NOT NULL OR
LAST_CF_CHG_EXP_DATE_DT IS NOT NULL OR
LAST_CF_ENT_QI_DT IS NOT NULL)
AND FISCAL_YEAR_START_DT >= DATE'2023-01-01'
AND FISCAL_YEAR_START_DT < CURRENT_DATE
--AND FISCAL_YEAR_END_DT > CURRENT_DATE
AND FISCAL_WEEK_END_DT < CURRENT_DATE
GROUP BY 1,2,3,4,5,6,7
